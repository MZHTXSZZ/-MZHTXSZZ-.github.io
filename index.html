<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>主神空间TRPG战役系统 - 玩家视图</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        :root {
            --primary-color: #0a0e17;
            --secondary-color: #1a243f;
            --accent-color: #00d4ff;
            --accent-glow: rgba(0, 212, 255, 0.7);
            --danger-color: #ff375f;
            --success-color: #00ff88;
            --warning-color: #ffa500;
            --text-color: #e0e0ff;
            --panel-color: rgba(10, 14, 23, 0.85);
            --border-color: #2a3a5f;
        }
        
        body {
            background-color: var(--primary-color);
            color: var(--text-color);
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(0, 100, 200, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(120, 0, 200, 0.1) 0%, transparent 20%),
                linear-gradient(to bottom, transparent 0%, rgba(0, 20, 40, 0.5) 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* 玩家提示栏 */
        .player-notice {
            background-color: rgba(0, 100, 200, 0.2);
            border-bottom: 1px solid var(--accent-color);
            padding: 1rem;
            text-align: center;
            color: var(--accent-color);
            font-size: 0.9rem;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        
        .player-notice i {
            font-size: 1.1rem;
        }
        
        /* 主神空间标题和装饰 */
        .header {
            text-align: center;
            padding: 2rem 1rem;
            position: relative;
            border-bottom: 1px solid var(--border-color);
            background-color: rgba(0, 0, 0, 0.3);
            margin-bottom: 2rem;
            box-shadow: 0 0 30px rgba(0, 100, 255, 0.2);
        }
        
        .main-title {
            font-size: 2.8rem;
            letter-spacing: 4px;
            text-transform: uppercase;
            background: linear-gradient(90deg, #00d4ff, #0080ff, #a000ff);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 15px var(--accent-glow);
            margin-bottom: 0.5rem;
            position: relative;
            display: inline-block;
        }
        
        .main-title::after {
            content: "";
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            height: 3px;
            background: linear-gradient(90deg, transparent, var(--accent-color), transparent);
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: #a0b0ff;
            letter-spacing: 1px;
            margin-top: 0.5rem;
        }
        
        /* 网格布局 */
        .container {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 2rem;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem 2rem;
        }
        
        @media (max-width: 1024px) {
            .container {
                grid-template-columns: 1fr;
            }
        }
        
        /* 面板通用样式 */
        .panel {
            background-color: var(--panel-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            position: relative;
            overflow: hidden;
        }
        
        .panel::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--accent-color), transparent);
        }
        
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid var(--border-color);
        }
        
        .panel-title {
            font-size: 1.5rem;
            color: var(--accent-color);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .panel-title i {
            font-size: 1.3rem;
        }
        
        /* 角色卡区域 */
        .characters-section {
            grid-column: 1;
        }
        
        .character-cards {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }
        
        .character-card {
            border: 1px solid var(--border-color);
            border-radius: 6px;
            overflow: hidden;
            transition: all 0.3s ease;
            background-color: rgba(20, 30, 50, 0.7);
            cursor: pointer;
        }
        
        .character-card:hover {
            border-color: var(--accent-color);
            box-shadow: 0 0 15px rgba(0, 212, 255, 0.3);
            transform: translateY(-3px);
        }
        
        .character-card.active {
            border-color: var(--accent-color);
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.5);
        }
        
        .character-header {
            background-color: rgba(0, 20, 40, 0.8);
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
        }
        
        .character-name {
            font-size: 1.3rem;
            font-weight: bold;
        }
        
        .character-status {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .status-alive {
            background-color: rgba(0, 255, 100, 0.2);
            color: #00ff88;
            border: 1px solid #00ff88;
        }
        
        .status-injured {
            background-color: rgba(255, 165, 0, 0.2);
            color: #ffa500;
            border: 1px solid #ffa500;
        }
        
        .status-dead {
            background-color: rgba(255, 55, 95, 0.2);
            color: var(--danger-color);
            border: 1px solid var(--danger-color);
        }
        
        .character-info {
            padding: 1rem;
        }
        
        .character-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px dashed rgba(100, 150, 255, 0.2);
        }
        
        .stat-value {
            color: var(--accent-color);
            font-weight: bold;
        }
        
        .character-skills {
            margin-top: 1rem;
        }
        
        .skill-tag {
            display: inline-block;
            background-color: rgba(0, 100, 200, 0.2);
            color: #80c0ff;
            padding: 0.3rem 0.7rem;
            border-radius: 4px;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
            font-size: 0.85rem;
            border: 1px solid rgba(0, 100, 200, 0.4);
        }
        
        /* 战役进度区域 */
        .campaign-section {
            grid-column: 2;
        }
        
        @media (max-width: 1024px) {
            .campaign-section {
                grid-column: 1;
            }
        }
        
        /* 任务时间线 */
        .timeline {
            position: relative;
            padding-left: 30px;
        }
        
        .timeline::before {
            content: "";
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(to bottom, var(--accent-color), transparent);
        }
        
        .timeline-item {
            position: relative;
            margin-bottom: 2rem;
            padding: 1rem;
            background-color: rgba(20, 30, 50, 0.5);
            border-radius: 6px;
            border-left: 3px solid var(--accent-color);
        }
        
        .timeline-item::before {
            content: "";
            position: absolute;
            left: -36px;
            top: 20px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: var(--accent-color);
            box-shadow: 0 0 10px var(--accent-glow);
        }
        
        .timeline-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }
        
        .mission-name {
            font-size: 1.2rem;
            color: var(--accent-color);
        }
        
        .mission-status {
            font-size: 0.9rem;
            padding: 0.2rem 0.6rem;
            border-radius: 4px;
        }
        
        .status-completed {
            background-color: rgba(0, 255, 100, 0.2);
            color: #00ff88;
        }
        
        .status-ongoing {
            background-color: rgba(0, 212, 255, 0.2);
            color: var(--accent-color);
            animation: pulse 2s infinite;
        }
        
        .status-upcoming {
            background-color: rgba(150, 150, 150, 0.2);
            color: #aaa;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .mission-desc {
            color: #b0c0ff;
            line-height: 1.5;
            margin-bottom: 0.5rem;
        }
        
        .mission-reward {
            color: #ffd700;
            font-size: 0.9rem;
        }
        
        /* 主神公告 */
        .announcement {
            background-color: rgba(255, 55, 95, 0.1);
            border: 1px solid rgba(255, 55, 95, 0.3);
            border-radius: 6px;
            padding: 1rem;
            margin-top: 1rem;
        }
        
        .announcement-header {
            color: var(--danger-color);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            font-weight: bold;
        }
        
        /* 队伍资源 */
        .resource-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        
        .resource-item {
            background-color: rgba(30, 40, 70, 0.5);
            padding: 1rem;
            border-radius: 6px;
            border: 1px solid var(--border-color);
        }
        
        .resource-name {
            font-size: 0.9rem;
            color: #a0b0ff;
            margin-bottom: 0.5rem;
        }
        
        .resource-value {
            font-size: 1.5rem;
            color: var(--accent-color);
            font-weight: bold;
        }
        
        /* 底部装饰 */
        .footer {
            text-align: center;
            padding: 2rem;
            margin-top: 3rem;
            border-top: 1px solid var(--border-color);
            color: #8090cc;
            font-size: 0.9rem;
        }
        
        /* 数据流效果 */
        .data-stream {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: -1;
            overflow: hidden;
        }
        
        .stream-line {
            position: absolute;
            width: 1px;
            height: 100px;
            background: linear-gradient(to bottom, transparent, var(--accent-color), transparent);
            animation: streamFall linear infinite;
        }
        
        @keyframes streamFall {
            0% { transform: translateY(-100px); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(100vh); opacity: 0; }
        }
        
        /* 主神控制台 */
        .console {
            font-family: 'Courier New', monospace;
            background-color: rgba(0, 0, 0, 0.7);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 1rem;
            margin-top: 1rem;
            color: #00ff00;
            font-size: 0.9rem;
            max-height: 150px;
            overflow-y: auto;
        }
        
        .console-line {
            margin-bottom: 0.3rem;
        }
        
        /* 角色详细信息区域 */
        .detail-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }
        
        /* 响应式调整 */
        @media (max-width: 768px) {
            .container {
                padding: 0 1rem;
                gap: 1rem;
            }
            
            .main-title {
                font-size: 2rem;
            }
            
            .panel {
                padding: 1rem;
            }
            
            .character-stats, .detail-stats {
                grid-template-columns: 1fr;
            }
            
            .resource-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- 数据流背景效果 -->
    <div class="data-stream" id="dataStream"></div>
    
    <!-- 玩家提示栏 -->
    <div class="player-notice">
        <i class="fas fa-eye"></i> 玩家视图 - 只读模式 | 最后更新: <span id="lastUpdateTime">加载中...</span>
    </div>
    
    <!-- 头部标题 -->
    <header class="header">
        <h1 class="main-title">
            <i class="fas fa-infinity"></i> 主神空间TRPG战役系统
        </h1>
        <p class="subtitle">轮回者信息监控面板 · 玩家视图</p>
        <div class="console" id="console">
            <div class="console-line">> 系统初始化完成...</div>
            <div class="console-line">> 加载战役数据...</div>
            <div class="console-line">> 玩家视图已启用...</div>
        </div>
    </header>
    
    <!-- 主要内容区域 -->
    <div class="container">
        <!-- 左侧角色卡区域 -->
        <section class="characters-section">
            <div class="panel" id="charactersPanel">
                <div class="panel-header">
                    <h2 class="panel-title"><i class="fas fa-users"></i> 轮回者小队</h2>
                    <span class="status-alive" id="characterCount">0 名活跃</span>
                </div>
                
                <div class="character-cards" id="characterCardsContainer">
                    <!-- 角色卡将通过JavaScript动态生成 -->
                </div>
            </div>
            
            <!-- 队伍资源 -->
            <div class="panel" id="resourcesPanel">
                <div class="panel-header">
                    <h2 class="panel-title"><i class="fas fa-coins"></i> 队伍资源</h2>
                </div>
                <div class="resource-grid" id="resourcesGrid">
                    <!-- 资源项将通过JavaScript动态生成 -->
                </div>
            </div>
        </section>
        
        <!-- 右侧战役进度区域 -->
        <section class="campaign-section">
            <div class="panel" id="campaignPanel">
                <div class="panel-header">
                    <h2 class="panel-title"><i class="fas fa-tasks"></i> 战役进度时间线</h2>
                    <span class="mission-status status-ongoing" id="campaignStatus">进行中</span>
                </div>
                
                <div class="timeline" id="timelineContainer">
                    <!-- 任务时间线将通过JavaScript动态生成 -->
                </div>
                
                <!-- 主神公告 -->
                <div class="announcement" id="announcementPanel">
                    <div class="announcement-header">
                        <i class="fas fa-exclamation-triangle"></i> 主神公告
                    </div>
                    <p id="announcementText">加载中...</p>
                </div>
            </div>
            
            <!-- 角色详细信息面板 -->
            <div class="panel" id="characterDetailPanel">
                <div class="panel-header">
                    <h2 class="panel-title"><i class="fas fa-id-card"></i> 角色详细信息</h2>
                </div>
                <div id="characterDetailContent">
                    <p>请点击左侧角色卡查看详细信息。</p>
                </div>
            </div>
        </section>
    </div>
    
    <!-- 页脚 -->
    <footer class="footer">
        <p>主神空间TRPG战役管理系统 v2.5 | 玩家只读视图</p>
        <p>如需更新数据，请联系战役主持人</p>
    </footer>

    <script>
        // 创建数据流背景效果
        function createDataStream() {
            const streamContainer = document.getElementById('dataStream');
            const streamCount = 15;
            
            for (let i = 0; i < streamCount; i++) {
                const stream = document.createElement('div');
                stream.className = 'stream-line';
                
                // 随机位置和动画速度
                const left = Math.random() * 100;
                const duration = 3 + Math.random() * 4;
                const delay = Math.random() * 5;
                
                stream.style.left = `${left}%`;
                stream.style.animationDuration = `${duration}s`;
                stream.style.animationDelay = `${delay}s`;
                
                // 随机高度
                const height = 50 + Math.random() * 150;
                stream.style.height = `${height}px`;
                
                streamContainer.appendChild(stream);
            }
        }
        
        // 默认数据（当本地没有数据时使用）
        const defaultData = {
            characters: [
                {
                    id: 1,
                    name: "张明 - '铁壁'",
                    class: "重装战士",
                    level: 5,
                    hp: "58/72",
                    sanity: "42/60",
                    status: "alive",
                    strength: 18,
                    dexterity: 12,
                    constitution: 16,
                    intelligence: 10,
                    wisdom: 14,
                    charisma: 8,
                    skills: ["重甲专精", "盾牌格挡", "嘲讽", "坚韧意志", "战术指挥", "生存知识"],
                    equipment: ["精钢全身甲", "塔盾", "+1长剑", "治疗药水×3", "圣水瓶"],
                    background: "前特种部队成员，在主神空间中找到了新的使命。以保护队友为己任，总是冲锋在前。",
                    currentCondition: "左臂轻度割伤，不影响战斗",
                    notes: ""
                },
                {
                    id: 2,
                    name: "林晓雨 - '影刃'",
                    class: "暗影刺客",
                    level: 5,
                    hp: "45/45",
                    sanity: "55/60",
                    status: "alive",
                    strength: 12,
                    dexterity: 18,
                    constitution: 14,
                    intelligence: 16,
                    wisdom: 14,
                    charisma: 10,
                    skills: ["潜行大师", "弱点洞察", "双武器战斗", "开锁专家", "陷阱解除", "易容术"],
                    equipment: ["+1匕首×2", "暗影披风", "开锁工具", "烟雾弹×5", "夜视镜"],
                    background: "前国际大盗，因意外进入主神空间。擅长无声行动和精确打击，是队伍的眼睛和匕首。",
                    currentCondition: "状态良好",
                    notes: ""
                },
                {
                    id: 3,
                    name: "赵海 - '圣光'",
                    class: "神圣牧师",
                    level: 5,
                    hp: "32/52",
                    sanity: "48/60",
                    status: "injured",
                    strength: 10,
                    dexterity: 12,
                    constitution: 14,
                    intelligence: 14,
                    wisdom: 18,
                    charisma: 16,
                    skills: ["治疗祷言", "驱散亡灵", "神圣护甲", "知识(宗教)", "劝导", "医疗"],
                    equipment: ["圣徽", "+1钉头锤", "链甲", "治疗药水×5", "圣水×3", "防护邪恶魔杖"],
                    background: "前神学院学生，信仰坚定。在主神空间中，他的信仰成为了对抗黑暗的力量源泉。",
                    currentCondition: "肋骨骨折，中等程度伤势，需要休养",
                    notes: "需要尽快治疗"
                },
                {
                    id: 4,
                    name: "王雪 - '奥术'",
                    class: "元素法师",
                    level: 5,
                    hp: "38/38",
                    sanity: "35/60",
                    status: "alive",
                    strength: 8,
                    dexterity: 14,
                    constitution: 12,
                    intelligence: 18,
                    wisdom: 16,
                    charisma: 14,
                    skills: ["火球术", "寒冰护甲", "奥术智慧", "魔法鉴定", "法术穿透", "召唤元素"],
                    equipment: ["+1法杖", "法师袍", "法术材料包", "魔力宝石×3", "防护戒指", "辨识卷轴×5"],
                    background: "理论物理学家，对多维空间和神秘学有深入研究。在主神空间中，她的知识转化为了强大的魔法力量。",
                    currentCondition: "理智值偏低，出现轻微幻觉，需要休息",
                    notes: "注意理智值恢复"
                }
            ],
            missions: [
                {
                    id: 1,
                    name: "初始试炼: 寂静岭",
                    status: "completed",
                    description: "小队首次进入恐怖世界，在迷雾笼罩的小镇中对抗扭曲生物并探索真相。成功解救关键NPC并获取重要线索。",
                    reward: "1500点数, D级支线剧情×1",
                    order: 1
                },
                {
                    id: 2,
                    name: "血月诅咒: 亚楠之夜",
                    status: "completed",
                    description: "进入哥特式恐怖城市亚楠，在猎杀之夜生存并寻找治愈血疗的方法。击败 cleric beast 和神父 Gascoigne。",
                    reward: "3000点数, C级支线剧情×1, 猎人徽章",
                    order: 2
                },
                {
                    id: 3,
                    name: "古神低语: 曼西斯梦魇",
                    status: "ongoing",
                    description: "探索曼西斯学派隐藏的噩梦，对抗使用禁忌召唤术的学者与降临的古神眷属。当前进度: 已击败噩梦之主米克拉什。",
                    reward: "5000点数, B级支线剧情×1, 第三脐带",
                    order: 3
                },
                {
                    id: 4,
                    name: "深渊回响: 渔村诅咒",
                    status: "upcoming",
                    description: "前往被遗忘的渔村，调查科斯的孤儿与海洋古神的秘密。预计难度: 极高。推荐等级: 6+。",
                    reward: "8000点数, A级支线剧情×1, 古神之血",
                    order: 4
                },
                {
                    id: 5,
                    name: "最终试炼: 月之梦境",
                    status: "upcoming",
                    description: "击败月之精灵，终结猎杀之夜循环，或是选择成为新的古神。任务条件: 完成所有前置任务，收集至少3条第三脐带。",
                    reward: "15000点数, S级支线剧情×1, 主神特权",
                    order: 5
                }
            ],
            resources: [
                { name: "奖励点数", value: "8,500", id: "points" },
                { name: "支线剧情", value: "B级×2, C级×3", id: "sideQuests" },
                { name: "复活次数", value: "1/2", id: "revives" },
                { name: "补给剩余", value: "12 天", id: "supplies" }
            ],
            announcement: "当前世界剩余时间: <strong>14天</strong>。主线任务失败惩罚: 全员抹杀。支线任务'净化该隐赫斯特'已解锁，完成可获得额外奖励。",
            settings: {
                adminMode: false,
                lastSaved: new Date().toISOString()
            }
        };
        
        // 从本地存储加载数据
        function loadData() {
            const savedData = localStorage.getItem('trpgCampaignData');
            if (savedData) {
                try {
                    const data = JSON.parse(savedData);
                    
                    // 显示最后更新时间
                    if (data.settings && data.settings.lastSaved) {
                        const lastSaved = new Date(data.settings.lastSaved);
                        document.getElementById('lastUpdateTime').textContent = 
                            lastSaved.toLocaleString('zh-CN');
                    } else {
                        document.getElementById('lastUpdateTime').textContent = "未知";
                    }
                    
                    return data;
                } catch (e) {
                    console.error("解析保存数据失败:", e);
                    return defaultData;
                }
            } else {
                // 如果没有保存的数据，使用默认数据
                document.getElementById('lastUpdateTime').textContent = "无数据";
                return defaultData;
            }
        }
        
        // 渲染角色卡
        function renderCharacterCards(characters) {
            const container = document.getElementById('characterCardsContainer');
            container.innerHTML = '';
            
            if (!characters || characters.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #aaa; padding: 2rem;">暂无角色数据</p>';
                return;
            }
            
            characters.forEach((character, index) => {
                const card = document.createElement('div');
                card.className = 'character-card';
                card.dataset.index = index;
                
                if (index === 0) {
                    card.classList.add('active');
                }
                
                // 状态文本
                let statusText = '未知';
                if (character.status === 'alive') statusText = '存活';
                else if (character.status === 'injured') statusText = '受伤';
                else if (character.status === 'dead') statusText = '死亡';
                
                card.innerHTML = `
                    <div class="character-header">
                        <div class="character-name">${character.name}</div>
                        <span class="character-status status-${character.status}">
                            ${statusText}
                        </span>
                    </div>
                    <div class="character-info">
                        <div class="character-stats">
                            <div class="stat-item">
                                <span>职业:</span>
                                <span class="stat-value">${character.class}</span>
                            </div>
                            <div class="stat-item">
                                <span>等级:</span>
                                <span class="stat-value">${character.level}</span>
                            </div>
                            <div class="stat-item">
                                <span>生命值:</span>
                                <span class="stat-value">${character.hp}</span>
                            </div>
                            <div class="stat-item">
                                <span>理智值:</span>
                                <span class="stat-value">${character.sanity}</span>
                            </div>
                        </div>
                        <div class="character-skills">
                            ${character.skills.slice(0, 4).map(skill => 
                                `<span class="skill-tag">${skill}</span>`
                            ).join('')}
                            ${character.skills.length > 4 ? '<span class="skill-tag">...</span>' : ''}
                        </div>
                    </div>
                `;
                
                // 添加点击事件
                card.addEventListener('click', () => {
                    selectCharacter(index, characters);
                });
                
                container.appendChild(card);
            });
            
            // 更新角色计数
            const aliveCount = characters.filter(c => c.status === 'alive').length;
            document.getElementById('characterCount').textContent = `${aliveCount} 名活跃`;
        }
        
        // 渲染战役时间线
        function renderCampaignTimeline(missions) {
            const container = document.getElementById('timelineContainer');
            container.innerHTML = '';
            
            if (!missions || missions.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #aaa; padding: 2rem;">暂无任务数据</p>';
                return;
            }
            
            // 按顺序排序任务
            const sortedMissions = [...missions].sort((a, b) => (a.order || 0) - (b.order || 0));
            
            sortedMissions.forEach((mission, index) => {
                const item = document.createElement('div');
                item.className = 'timeline-item';
                
                // 状态文本
                let statusText = '';
                let statusClass = '';
                
                switch(mission.status) {
                    case 'completed':
                        statusText = '已完成';
                        statusClass = 'status-completed';
                        break;
                    case 'ongoing':
                        statusText = '进行中';
                        statusClass = 'status-ongoing';
                        break;
                    case 'upcoming':
                        statusText = '即将开始';
                        statusClass = 'status-upcoming';
                        break;
                    default:
                        statusText = '未知';
                        statusClass = 'status-upcoming';
                }
                
                item.innerHTML = `
                    <div class="timeline-header">
                        <div class="mission-name">${mission.name}</div>
                        <span class="mission-status ${statusClass}">${statusText}</span>
                    </div>
                    <p class="mission-desc">${mission.description}</p>
                    <div class="mission-reward">
                        <i class="fas fa-award"></i> 奖励: ${mission.reward}
                    </div>
                `;
                
                container.appendChild(item);
            });
            
            // 更新战役状态
            const ongoingMission = missions.find(m => m.status === 'ongoing');
            document.getElementById('campaignStatus').textContent = ongoingMission ? '进行中' : '已完成';
        }
        
        // 渲染资源
        function renderResources(resources) {
            const container = document.getElementById('resourcesGrid');
            container.innerHTML = '';
            
            if (!resources || resources.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #aaa; grid-column: 1 / -1;">暂无资源数据</p>';
                return;
            }
            
            resources.forEach((resource, index) => {
                const item = document.createElement('div');
                item.className = 'resource-item';
                
                item.innerHTML = `
                    <div class="resource-name">${resource.name}</div>
                    <div class="resource-value">${resource.value}</div>
                `;
                
                container.appendChild(item);
            });
        }
        
        // 渲染公告
        function renderAnnouncement(announcement) {
            document.getElementById('announcementText').innerHTML = 
                announcement || "暂无公告";
        }
        
        // 选择角色并显示详细信息
        function selectCharacter(index, characters) {
            if (index < 0 || index >= characters.length) return;
            
            const character = characters[index];
            
            // 更新角色卡活跃状态
            document.querySelectorAll('.character-card').forEach(card => {
                card.classList.remove('active');
            });
            const selectedCard = document.querySelector(`.character-card[data-index="${index}"]`);
            if (selectedCard) {
                selectedCard.classList.add('active');
            }
            
            // 状态文本
            let statusText = '未知';
            if (character.status === 'alive') statusText = '存活';
            else if (character.status === 'injured') statusText = '受伤';
            else if (character.status === 'dead') statusText = '死亡';
            
            // 构建详细信息HTML
            let detailHTML = `
                <h3 style="color: var(--accent-color); margin-bottom: 1rem;">${character.name}</h3>
                <div class="detail-stats">
                    <div class="stat-item">
                        <span>职业:</span>
                        <span class="stat-value">${character.class}</span>
                    </div>
                    <div class="stat-item">
                        <span>等级:</span>
                        <span class="stat-value">${character.level}</span>
                    </div>
                    <div class="stat-item">
                        <span>状态:</span>
                        <span class="stat-value status-${character.status}" style="display: inline-block; padding: 0.2rem 0.5rem;">
                            ${statusText}
                        </span>
                    </div>
                    <div class="stat-item">
                        <span>生命值:</span>
                        <span class="stat-value">${character.hp}</span>
                    </div>
                    <div class="stat-item">
                        <span>理智值:</span>
                        <span class="stat-value">${character.sanity}</span>
                    </div>
                    <div class="stat-item">
                        <span>当前状态:</span>
                        <span class="stat-value">${character.currentCondition || "状态良好"}</span>
                    </div>
                </div>
                
                <h4 style="color: var(--accent-color); margin-bottom: 0.5rem;">属性值</h4>
                <div class="detail-stats">
                    <div class="stat-item">
                        <span>力量:</span>
                        <span class="stat-value">${character.strength || 10} (+${Math.floor(((character.strength || 10)-10)/2)})</span>
                    </div>
                    <div class="stat-item">
                        <span>敏捷:</span>
                        <span class="stat-value">${character.dexterity || 10} (+${Math.floor(((character.dexterity || 10)-10)/2)})</span>
                    </div>
                    <div class="stat-item">
                        <span>体质:</span>
                        <span class="stat-value">${character.constitution || 10} (+${Math.floor(((character.constitution || 10)-10)/2)})</span>
                    </div>
                    <div class="stat-item">
                        <span>智力:</span>
                        <span class="stat-value">${character.intelligence || 10} (+${Math.floor(((character.intelligence || 10)-10)/2)})</span>
                    </div>
                    <div class="stat-item">
                        <span>感知:</span>
                        <span class="stat-value">${character.wisdom || 10} (+${Math.floor(((character.wisdom || 10)-10)/2)})</span>
                    </div>
                    <div class="stat-item">
                        <span>魅力:</span>
                        <span class="stat-value">${character.charisma || 10} (+${Math.floor(((character.charisma || 10)-10)/2)})</span>
                    </div>
                </div>
                
                <h4 style="color: var(--accent-color); margin-bottom: 0.5rem;">技能与专长</h4>
                <div style="margin-bottom: 1.5rem;">
            `;
            
            // 添加技能标签
            if (character.skills && character.skills.length > 0) {
                character.skills.forEach(skill => {
                    detailHTML += `<span class="skill-tag">${skill}</span> `;
                });
            } else {
                detailHTML += '<span style="color: #aaa;">暂无技能数据</span>';
            }
            
            detailHTML += `
                </div>
                
                <h4 style="color: var(--accent-color); margin-bottom: 0.5rem;">装备与物品</h4>
                <div style="margin-bottom: 1.5rem;">
            `;
            
            // 添加装备标签
            if (character.equipment && character.equipment.length > 0) {
                character.equipment.forEach(item => {
                    detailHTML += `<span class="skill-tag" style="background-color: rgba(100, 80, 0, 0.2); border-color: #cc9900;">${item}</span> `;
                });
            } else {
                detailHTML += '<span style="color: #aaa;">暂无装备数据</span>';
            }
            
            detailHTML += `
                </div>
                
                <h4 style="color: var(--accent-color); margin-bottom: 0.5rem;">背景故事</h4>
                <p style="line-height: 1.6; color: #b0c0ff;">${character.background || "暂无背景故事"}</p>
            `;
            
            if (character.notes) {
                detailHTML += `
                    <h4 style="color: var(--accent-color); margin-bottom: 0.5rem; margin-top: 1rem;">备注</h4>
                    <p style="line-height: 1.6; color: #ffa500;">${character.notes}</p>
                `;
            }
            
            // 更新详细信息面板
            document.getElementById('characterDetailContent').innerHTML = detailHTML;
            
            // 添加控制台消息
            addConsoleMessage(`> 正在访问轮回者档案: ${character.name}`);
        }
        
        // 添加控制台消息
        function addConsoleMessage(message) {
            const consoleElement = document.getElementById('console');
            const newLine = document.createElement('div');
            newLine.className = 'console-line';
            newLine.textContent = message;
            consoleElement.appendChild(newLine);
            
            // 滚动到底部
            consoleElement.scrollTop = consoleElement.scrollHeight;
        }
        
        // 渲染所有内容
        function renderAll() {
            const data = loadData();
            
            if (!data) {
                addConsoleMessage("> 错误: 无法加载数据");
                return;
            }
            
            const characters = data.characters || [];
            const missions = data.missions || [];
            const resources = data.resources || [];
            const announcement = data.announcement || "暂无公告";
            
            renderCharacterCards(characters);
            renderCampaignTimeline(missions);
            renderResources(resources);
            renderAnnouncement(announcement);
            
            // 默认选择第一个角色
            if (characters.length > 0) {
                selectCharacter(0, characters);
            }
            
            addConsoleMessage(`> 已加载 ${characters.length} 个角色，${missions.length} 个任务`);
        }
        
        // 添加安全限制
        function addSecurityRestrictions() {
            // 禁止右键菜单
            document.addEventListener('contextmenu', function(e) {
                e.preventDefault();
            });
            
            // 禁止F12
            document.onkeydown = function(e) {
                if (e.keyCode == 123) { // F12
                    return false;
                }
            };
            
            // 禁止拖拽
            document.addEventListener('dragstart', function(e) {
                e.preventDefault();
            });
            
            // 禁止选择文本
            document.addEventListener('selectstart', function(e) {
                e.preventDefault();
            });
        }
        
        // 初始化页面
        document.addEventListener('DOMContentLoaded', function() {
            createDataStream();
            addSecurityRestrictions();
            renderAll();
            
            // 添加控制台消息
            addConsoleMessage("> 系统初始化完成");
            addConsoleMessage("> 玩家只读模式已启用");
            addConsoleMessage("> 所有编辑功能已禁用");
            
            // 添加数据自动刷新（每30秒检查一次更新）
            setInterval(() => {
                // 只是更新最后更新时间，不重新加载所有数据以避免闪烁
                const savedData = localStorage.getItem('trpgCampaignData');
                if (savedData) {
                    try {
                        const data = JSON.parse(savedData);
                        if (data.settings && data.settings.lastSaved) {
                            const lastSaved = new Date(data.settings.lastSaved);
                            document.getElementById('lastUpdateTime').textContent = 
                                lastSaved.toLocaleString('zh-CN');
                        }
                    } catch (e) {
                        console.error("更新最后时间失败:", e);
                    }
                }
            }, 30000); // 30秒刷新一次
        });
    </script>
</body>
</html>
